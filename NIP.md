# NIP-XX: Nostr Art Auction Protocol

`draft` `optional`

This NIP defines a protocol for conducting art auctions on Nostr, extending the marketplace concepts from NIP-15 with enhanced auction mechanics including time extensions and international shipping.

## Event Kinds

| Kind    | Description                    |
|---------|--------------------------------|
| `30020` | Auction Listing               |
| `1021`  | Bid                           |
| `1022`  | Bid Confirmation              |
| `1023`  | Auction Status Update         |

## Auction Listing (Kind 30020)

An auction listing is a replaceable event that describes an artwork being auctioned.

**Event Content:**
```json
{
  "id": "<string, UUID generated by the merchant>",
  "stall_id": "<string, UUID of the stall>",
  "title": "<string, artwork title>",
  "description": "<string, artwork description>",
  "images": ["<string, image URLs>"],
  "starting_bid": <int, starting bid in sats>,
  "reserve_price": <int, optional reserve price in sats>,
  "start_date": <int, UNIX timestamp when auction starts>,
  "duration": <int, auction duration in seconds>,
  "auto_extend": <bool, whether to auto-extend when bids in last 5 minutes>,
  "extension_time": <int, seconds to extend by (default 300)>,
  "shipping": {
    "local": {
      "cost": <int, local shipping cost in sats>,
      "countries": ["<string, country codes>"]
    },
    "international": {
      "cost": <int, international shipping cost in sats>
    }
  },
  "artist_info": {
    "name": "<string, artist name>",
    "bio": "<string, artist biography>",
    "website": "<string, artist website>"
  }
}
```

**Event Tags:**
```json
{
  "tags": [
    ["d", "<auction_id>"],
    ["t", "art"],
    ["t", "auction"],
    ["title", "<artwork_title>"],
    ["starting_bid", "<starting_bid_sats>"],
    ["currency", "sats"],
    ["start_date", "<unix_timestamp>"],
    ["duration", "<duration_seconds>"],
    ["image", "<primary_image_url>"],
    ["location", "<artist_location>"]
  ]
}
```

## Bid (Kind 1021)

A bid event represents a user's bid on an auction.

**Event Content:**
```json
{
  "amount": <int, bid amount in sats>,
  "shipping_option": "<local|international>",
  "buyer_country": "<string, buyer's country code>",
  "message": "<string, optional message to seller>"
}
```

**Event Tags:**
```json
{
  "tags": [
    ["e", "<auction_event_id>", "<relay_hint>"],
    ["p", "<auction_creator_pubkey>"],
    ["amount", "<bid_amount_sats>"],
    ["shipping", "<shipping_option>"]
  ]
}
```

## Bid Confirmation (Kind 1022)

Merchants confirm bids to indicate their validity.

**Event Content:**
```json
{
  "status": "<accepted|rejected|pending|winner>",
  "message": "<string, optional message>",
  "duration_extended": <int, optional seconds extended>,
  "total_cost": <int, bid amount + shipping in sats>
}
```

**Event Tags:**
```json
{
  "tags": [
    ["e", "<bid_event_id>"],
    ["e", "<auction_event_id>"],
    ["p", "<bidder_pubkey>"]
  ]
}
```

## Auction Status Update (Kind 1023)

Updates on auction status including extensions and completion.

**Event Content:**
```json
{
  "auction_id": "<string, auction ID>",
  "status": "<active|extended|completed|cancelled>",
  "end_time": <int, updated end time if extended>,
  "winning_bid": <int, optional winning bid amount>,
  "winner_pubkey": "<string, optional winner pubkey>",
  "message": "<string, optional status message>"
}
```

**Event Tags:**
```json
{
  "tags": [
    ["e", "<auction_event_id>"],
    ["status", "<auction_status>"],
    ["end_time", "<unix_timestamp>"]
  ]
}
```

## Auction Mechanics

### Time Extensions
- When `auto_extend` is true and a bid is placed in the last 5 minutes, the auction is automatically extended by `extension_time` seconds (default 300)
- Extensions are announced via Auction Status Update events
- Multiple extensions can occur if bids continue in the final minutes

### Shipping Calculation
- Buyers must specify their country when bidding
- Local shipping applies to countries listed in the auction's local shipping countries
- All other countries use international shipping rates
- Total cost = bid amount + applicable shipping cost

### Payment Integration
- Uses NIP-57 Lightning Zaps for payments
- WebLN integration for seamless Lightning payments
- Winning bidders receive payment requests via NIP-04 encrypted messages

### Comments and Reactions
- NIP-22 comments can be made on auction events
- NIP-25 reactions (likes) can be used to show interest
- Comments use the auction event ID as the root scope

## Implementation Notes

- Auction events are replaceable (kind 30020) and can be updated before the first bid
- Once a bid is received, the auction cannot be modified
- Bids reference the specific version of the auction event
- All monetary amounts are specified in satoshis
- Country codes should follow ISO 3166-1 alpha-2 standard